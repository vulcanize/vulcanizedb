dist: trusty
language: go
go:
- 1.12
services:
- postgresql
- docker
addons:
  postgresql: '11.6'
go_import_path: github.com/makerdao/vulcanizedb
before_install:
- make installtools
- bash ./scripts/install-postgres-11.sh
- curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
- echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
- sudo apt-get update && sudo apt-get install yarn python3-pip -y
- sudo pip3 install awscli
script:
- env GO111MODULE=on make test
- env GO111MODULE=on make integrationtest
deploy:
- provider: script
  script: bash ./.travis/deploy.sh staging
  on:
    branch: staging
- provider: script
  script: bash ./.travis/deploy.sh prod
  on:
    branch: master
notifications:
  email: false
env:
  matrix:
    secure: Bm0u6E0esyVjJ2SMg5kVKkTJI+q0vSTOlRUFsfYQG6xAPqaxPH3iXiIwtUIuWK/pKwGtMsXDTiLuoFFASdu+AWRto2I9FisgO/foZhnsfHc1wBLOj1PCukwYl1LUPrS21QAigoZ24YQi1PHx1INjjSX+2cAIoSsj1LD74L6GcwxZi4A0yh3Ntmtv5ttn6mtDr3GeKh6iaw2vS9OeHRUb4ARlz+pxgNULyYF8AR5cKp2gDX8SrDCikwjJm/i2fKOTfWSxKD/EenaeHKciBnakDAWGs90EOhNlakM5DGFhgGhGKKL/DTImb56VfQfOAJEgxIdNPSUPUJV6WLBGhRKOawfZem/8bV54j89QfVg2H4wKtU62OA4eT5IRKiyTPh1sk7QfVZAHWDnmjUsThaXIErNIHOwEMU+uaXY1bOgXBYG2dqsE0rOGZ+TxzrIzOVAr/4pU6b2qmI60OrjnX9dgX9jcm79FHiLtBYkuu12MrYUcuOt2n8bsqeZ/GkrcaEL25hQghaDsziWkthqciierTwzXZrleLARARjitv04aOV0/FQrawkxEysQXPVklWv9JVlk63+BGp6Wb5YVSDKfCYetPF9e31nwG8gIrglFpE5hgAycUkA6ms+EOJ+6UrUBRQt5JxCaxJ58n7QHOFscRWGfW90oIQ3jftyscKERMn/c=
  global:
  - secure: tz62S53XiFomz/R/X0Rl143KLugl/cBCP8C2us5v5qbJhqbVrOUXPKsK6HZThl20S8EqHC/yaXUWrL6+mhTFH3Ee4GILvchMpAHfqOWYZOWtxcgoO/2UcOKzjBORMJK/Oosp/OAYrR86Om1T4P1gatsbIm90dnE6ausBsNxLtCjCr+Ozbx4yDJ37X327o4uvm+0O0+SbxJw8/aVgtNUJDXqNp1CjwtXwrUTH6PbxNiRGgFrZ24lSS0+0ESCJ5GVZSVSWKDUf4ML5gLCA5/JxKooZisUpbbtHPa9CYzbK8jF4eSYbWrg9W3zJ5Xv2+fN7uFBut/DJbg9RWboSo2txWcv/z1Jdao4q0boOgGgYGf8pphKsx2oNVc5ZKgnygAlN1wma7dwddfiTh3u4WB3zzWbjgj0ONhYkMFhKOjMLqNdAdNjOfFUZB2+Xf/FPUKc5MfL0b2GWpEf/sKhJ1xkf8ZpQgbiyCpaDDIQHoGUsrFVQKk8/frEsLWgdJQlZciuNHDThdHntEQx38EcvotKWss5Mc2tcF+HNr32ob0PuQl6aHkuAX9JwR9hYg6UcoG3MTcCta/e4kZ0PmcltXzbvVVM0+NzcQv6vVsBqH3CNY+Uhhd2uIYluescJNhwfK5g+PHDPgQsT0iGJTXDVmR0H658joBTNniYBsWujJ0o6rSg=
  - secure: qJYh+sEjGmDb4SyXnHkvu+1JEYExaRDbapwVdfx/U8e+AK7ZNno4wsHEEA8aMZVkNW7JOfsRjx3Dp1B6Rgd/2QH6J40yz7hMbCZWbres7KnBD3ib8iwHT5TeQ+DndNZh5wDGgNkxgyDWB05fdtAVu6fH77dWaiCkvejI/Jsl0HSUyv+B+TeoC4SkgQgfWSiHOdQ6Q47LVgmL7Yu64+AwwGBawqFvwZdy6pYk0nJtmliYxA3Uaucaml2O1U/fR4bYejzpqz6mnJsuSsLjZKuzrjPFwRVtpc1MsKYyX/Vs7DYnETi+fbCqxB6zbJjelsKMsq83tN6Gk+zk49AWPehQ/UAE3HdOdJo31JJ5MUt8DLL5oczDdTWIaRiNa+Oidoemmf+8w1TwUQavgBe3ubMwPtBf/m+jPUDTpCsykYjwQDyPCl8W3vI+rxgXQcwIn9v0JCdcM+lmPaQ0v41WXxEBxbQriYHeOAbRyU9RR68rnvQQ7Ly2yUne2onEASW8dEGepelvk4Wddc7Oa58fOXzWK2pM1g0K2MtR1weLsRQiDrI0IFQqXJQzXsrXLoYkSeU/FP/j9RP21sd7b4gXcnSRuV3Z6PeoAgbGegrrIQm3bnFdxZs47mov8c01cG7ExdhT78dp1TvKe90JI82DYK/aZOEK9jKoT+sbZsHpojVxOJI=
  - secure: c9L/ZJY5JmPlDDlwDPh+guvzY07FUAr3Kh6xenWalzbVzRscFyUtaJTFpjaxzQmI4ICWXQh08A7kEpE/7nd87raBaLRj29KkCjHgKWWgV0x/30Uzu15GiKl7BbhiAukRLTT84abtb7KqTxkBsXyGLIn/xBszE9cNPRXiFb84EEGlNNb9saDV+e8fir3quHxdwCWGHzfl/Li8n5pY/v3wIioDnGU20O16QtL0vTChI8jLaZxvdwB52Je8YgzFPEPz0bJbmHHdV892VPI3P6XyWBJ2Dz94a0tOrFUCBDXFG7rZUBOXcJwtJFNn9c8jAGXdaz7BhAGICAHRqcnxf4N/d10I7cZM8IXQXPb6U1T93KUvn8cKyfPGiSRkmxuc8zkrkRPBVzqDuIFvjOfZ+RkmAQF8+3SnjFuMFWrCDUPy/WkU3sa6JbW4cFkMtc03E8zpzVmeB3MxMbwAtO+wohg83/YTNe6l2sBcMVBxn3zfUAn+uen3KJ3xlXShkMgYFYnhJ7Y26M+kMHuZ1uR8t9Htsx7dCOJM/0IPMTKVk4AhB0vzE3h2SMD91EdScYjmGXrr/xCuGxKeJawow3+CAQZlgq5QwUMsYo2yEDrqm7/FEQbilkVEtdi0V15oL9EEnyOiDWnS6Fjp2R+CN7oKtJU2EYbFXTEmlFtuh4KG75Jmn/E=
  - secure: kh8o0PUc5zQfvQ1zaX9mKY+EJW5T9PWxGbVTR/ui30yh6UlSjAYHW3dySUT6kqfuZW8CPsSbFQg5DOgSJquYXf2CzHYdb9pUWgX+7bwUCRArndDS84JpgHw8Am9NHfJzegs2+gOX8ul+pbnc4xkYsBaLzh3paIQAr4IZbfqvSfiQiqNKtcAxB2j2ZYBbhxG7pLHmYIp3rB4UUzoMO7jdcPxA2+YxoNJVYjekayk/LFfmpP70BTe9rKCJkyaap+/kl+lAyVR0f1hyRYbwQVOrLRLWga5avYZetFV5XyrqLFwBghfnzDOGWH9J8/iRXWKoWYTO+1G4Cka/74UCqCoYrm5mi/j3GFX0KRjgX7vxcyWjab8uu6L2ictRQq8wP2gE+wuftySDgCtqf2rijsUGFtiA3h2sqUPtKnQD9Zu+e4XnuyHJPtJ1jwviBUgx1N1t5uskx1h5VS+xVG4gc+9zQq3LI+RYOOlVyWfDhK0WxVPbtwH/s9nFibVnNdA2X6fs409toEq9aEbdg9I9Xtz3U6qPYM88BMC6FnrySFFydNxfKCtVldUQmA5Tj3mCexbeTMRS57WmXZLRlWIIisFkTKNYUP9x8RtwOM1OtbiM9HyVs4l7rBIw7iVmidEdb5PYlfFfK7sc32qrQtz5Pr+e9y6ogAMK3u7WEl5EP/ozeOI=
  - secure: cmszNhIpQ7j+MKvs9sEUKTBtoJDYb4wh1seFvJ6JhZw8RL3/y1XWPFBdOFtG9rKLgCj3UxT3+S634gkI4bqJUZUbhZ9HyZBEy6E+JkKHadRPaL6+n0ICcak9ZgZLR/pzN1Bt3KG/vpqSDNr2wkykmaDb81RZy/4UIB74UYFrwi+f03jGZf1cKIHh/y8BONnP7mBTrHHweUnleXpUeAJGzDWW/FckkkAQ7s0BR0xM2WnA7FQNz9jDVhNMkhqCZqnebOIdBx6ufVvIR0nW9xI51Qfj9NJCotvH4Wv2PNdXE9i7+yv7b36cMyj6zNmrGM15l452GHbn+d1ZQugaOajGOuj8MV1Rdo+tTv/YSIAm/2+cN1HM0s0b9Q3WMqBZLsyiNcKB4QBIA/8tqKsgtcvIsPdm0AVya+YFImR4xe4rVxgo5KMfJJ/E4FyxgxnVW22uI6zGHrEgxq3XIIIlOyl/fIijTw/C3kouK3YjiDMlkVqYMw4n7zG1/JZqUX4Ji7CbAsMXJQrR3mj3jmPbLTgnnGuUcplFi5ACqdm6OgAYpjGFgQ6JuooY29yjOR3ZdKSFgVEa6EtM+ogw641+tAyC/ejOcIj7TlJqYlTPulDXgi0dsdmnmltnkBYbdAAekdBKCUUh3FQM/CppTLph7qjqLApi2RsxkeWFwucASmjCBJY=
  - secure: hwZs74XuEetCC9cHGiLFYzmmGARYBQfON/ikR+ZPlfYIVo5oUyD1urf5DhEyjkQKLWpp+4u5tIH7tfImy3FFX9ZBQk3cnw/SfsFeyMgK0vrGVh3ErVPV9Tk1Ebluf+maF3i7TiU06/+JkqzpBstrazdFuAqjHTjKYzddujqZmXZyw1+HQXdBrsXedKWeXAmrSp9+sQ3TiBqHjOSagQJdAxscTrNKkut1fesn6tycjBAqKw1k6shhQwQwyNo38or8ewEWbCejqPOrE/ONIOVo7HSl1WKWbXFpfu4IStPKUXxXUdM5as3oXOLKp0jmNq9tv8KgygGWTaXOeDX6fr/cSpY23vHCZl6m5e0aiZBW65zQx5Yj1xMiiuyAtIUXSzLZSdYqXoEV2cYfxQFxTkGT2S3l8c+f7ZNhjauPglPwP5mRfZuhln6h6pdVBoGGI152LGOnAqTWwju+0zudvXTbwfZOk2KVb1zysxAleJVEm4hJoxwLeZLVOJn7kEWDjXNT6+M1L6q5zsDyjA418RL/MElDjqDsMVvJXFHB3wGCqr+KhbTz3cjLMifUnMeD52j3hTXUgzmqpzHAS4yrt8M6j8meQxDfO5WHj1NHF6xv5afqjPiPeCJNCnPw2116RnyWWFn5DSa05zmo8Wvi8+IRcCjB0eILfQoWYcwGW9MvlkA=
  - secure: XYufEAOLMgd9gwC//F4QuPZCVn/orkpm+eBOAAiKEBpIPTmrV4ZhWYZdFzd18v4/mQA026+hr4W77HHe5eEyP8T2A20hh2r+Zl4Ou20Er2dV+Dja2bVX8GzPTSgKjEkuJgJGTUZX+JfdC2Otf82PO4u+j7/ay8LgKLrPatpqbC8nb5tsQ3NVPj4uXaK8nByjcoAygMMlobsEIA6w45AtvwU+Y/t5m0uyqFyt775Tme5Z7S2ppANMXLgJsDHIi/QOHNRAu27+F7Bi9/6lDhJwN8Nf4f8xsb/CnMqfzgX02h/VoSnerJe1cwFWGnV1g7kcVAACXSSxng+PqVNTf4ll9O4BnEg46KtxK0SkXXlt+gnL8b67PoqoziR+wst0Wwi5XanHNo+ra006bavmH7dkv6bDR8K3JSPAktq50fbdWRG6Z5TsDvLK75GjAFgtI6qLw9u6PKPd8wir0AZOY1XJxzN8GGBLYwN46dzoviHoyCX/Q0uIcQIAem/eVSITnERUx4uv02H8geJ2J+pWrqTYdc+QjV80wgdjOWyPvHt1vj4d1bypMokOuXEcAXdUblr+fP6r5mqjUiIhXfdin8Jo+Pb+bIeQTb+hAfXiQu9hLqa561kRjml1BQDZb9f7oFgCx5ZExfQsOKVmjellOe16BgM4ZjyosXmqC4mkg2GhvtQ=
